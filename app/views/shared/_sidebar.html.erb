<!-- Sidebar -->
<div id="sidebar" class="fixed inset-y-0 left-0 z-40 w-64 bg-white border-r border-gray-200 transform -translate-x-full transition-transform duration-200 ease-in-out lg:translate-x-0 lg:static lg:inset-0">
  <div class="flex items-center justify-between px-4 py-4 border-b border-gray-200 lg:hidden">
    <span class="text-lg font-bold text-indigo-700">Menu</span>
    <button id="close-sidebar" class="p-2 rounded-md text-gray-500 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
      <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>
  <div class="px-4 py-6 space-y-4">
    <div class="flex items-center flex-shrink-0 px-4">
      <h1 class="text-white text-xl font-bold">Open School</h1>
    </div>
    <nav class="mt-5 flex-1 px-2 space-y-1">
      <% if current_user&.admin? %>
        <%= link_to admin_schools_path, class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{current_page?(admin_schools_path) ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}" do %>
          <i class="fas fa-school mr-3 flex-shrink-0 h-6 w-6"></i>
          Schools
        <% end %>
        <%= link_to admin_plans_path, class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{current_page?(admin_plans_path) ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}" do %>
          <i class="fas fa-tags mr-3 flex-shrink-0 h-6 w-6"></i>
          Plans
        <% end %>
      <% elsif current_user&.teacher? %>
        <%= link_to teachers_root_path, class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{current_page?(teachers_root_path) ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}" do %>
          <i class="fas fa-tachometer-alt mr-3 flex-shrink-0 h-6 w-6"></i>
          Dashboard
        <% end %>

        <%= link_to teachers_attendance_index_path, class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{current_page?(teachers_attendance_index_path) ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}" do %>
          <i class="fas fa-calendar-check mr-3 flex-shrink-0 h-6 w-6"></i>
          Attendance
        <% end %>

        <%= link_to teachers_timetables_path, class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{current_page?(teachers_timetables_path) ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}" do %>
          <i class="fas fa-clock mr-3 flex-shrink-0 h-6 w-6"></i>
          Timetables
        <% end %>

        <%= link_to teachers_leave_applications_path, class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{current_page?(teachers_leave_applications_path) ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}" do %>
          <i class="fas fa-calendar-alt mr-3 flex-shrink-0 h-6 w-6"></i>
          Leave Applications
        <% end %>

        <%= link_to teachers_teaching_materials_path, class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{current_page?(teachers_teaching_materials_path) ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}" do %>
          <i class="fas fa-book mr-3 flex-shrink-0 h-6 w-6"></i>
          Teaching Materials
        <% end %>

        <%= link_to teachers_student_progress_index_path, class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{current_page?(teachers_student_progress_index_path) ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}" do %>
          <i class="fas fa-chart-line mr-3 flex-shrink-0 h-6 w-6"></i>
          Student Progress
        <% end %>

        <%= link_to teachers_teacher_notices_path, class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{current_page?(teachers_teacher_notices_path) ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}" do %>
          <i class="fas fa-bullhorn mr-3 flex-shrink-0 h-6 w-6"></i>
          Notices
        <% end %>

        <%= link_to teachers_profile_path, class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{current_page?(teachers_profile_path) ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}" do %>
          <i class="fas fa-user mr-3 flex-shrink-0 h-6 w-6"></i>
          Profile
        <% end %>

        <%= link_to edit_teachers_profile_path, class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{current_page?(edit_teachers_profile_path) ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}" do %>
          <i class="fas fa-cog mr-3 flex-shrink-0 h-6 w-6"></i>
          Settings
        <% end %>
      <% elsif current_school.present? %>
        <%= link_to school_owner_path(current_school_owner), class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{current_page?(school_owner_path(current_school_owner)) ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}" do %>
          <i class="fas fa-tachometer-alt mr-3 flex-shrink-0 h-6 w-6"></i>
          Dashboard
        <% end %>

        <% if current_school&.feature_enabled?('students') %>
          <%= link_to schools_school_students_path(current_school), class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{current_page?(schools_school_students_path(current_school)) ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}" do %>
            <i class="fas fa-user-graduate mr-3 flex-shrink-0 h-6 w-6"></i>
            Students
          <% end %>
        <% end %>

        <% if current_school&.feature_enabled?('classes') %>
          <%= link_to schools_school_classes_path(current_school), class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{current_page?(schools_school_classes_path(current_school)) ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}" do %>
            <i class="fas fa-chalkboard mr-3 flex-shrink-0 h-6 w-6"></i>
            Classes
          <% end %>
        <% end %>

        <% if current_school&.feature_enabled?('teachers') %>
          <%= link_to schools_school_teachers_path(current_school), class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{current_page?(schools_school_teachers_path(current_school)) ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}" do %>
            <i class="fas fa-chalkboard-teacher mr-3 flex-shrink-0 h-6 w-6"></i>
            Teachers
          <% end %>
        <% end %>

        <% if current_school&.feature_enabled?('exams') %>
          <%= link_to schools_exams_path, class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{current_page?(schools_exams_path) ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}" do %>
            <i class="fas fa-file-alt mr-3 flex-shrink-0 h-6 w-6"></i>
            Exams
          <% end %>
        <% end %>

        <% if current_school&.feature_enabled?('finance') %>
          <%= link_to schools_fees_path, class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{current_page?(schools_fees_path) ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}" do %>
            <i class="fas fa-money-bill-wave mr-3 flex-shrink-0 h-6 w-6"></i>
            Finance
          <% end %>
        <% end %>

        <% if current_school&.feature_enabled?('library') %>
          <%= link_to schools_inventory_items_path, class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{current_page?(schools_inventory_items_path) ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}" do %>
            <i class="fas fa-book mr-3 flex-shrink-0 h-6 w-6"></i>
            Library
          <% end %>
        <% end %>

        <% if current_school&.feature_enabled?('transport') %>
          <div class="space-y-1" 
               data-controller="dropdown"
               data-dropdown-menu-class="hidden"
               data-dropdown-expanded-class="rotate-180">
            <button type="button" 
                    class="group w-full flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white" 
                    data-action="click->dropdown#toggle">
              <i class="fas fa-bus mr-3 flex-shrink-0 h-6 w-6"></i>
              <span class="flex-1">Transport</span>
              <i class="fas fa-chevron-down ml-3 flex-shrink-0 h-4 w-4 transition-transform duration-200" 
                 data-dropdown-target="icon"></i>
            </button>
            <div class="hidden space-y-1" data-dropdown-target="menu">
              <%= link_to schools_transport_routes_path, class: "group flex items-center pl-11 pr-2 py-2 text-sm font-medium rounded-md #{current_page?(schools_transport_routes_path) ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}" do %>
                <i class="fas fa-route mr-3 flex-shrink-0 h-5 w-5"></i>
                Routes
              <% end %>
              <%= link_to schools_transport_vehicles_path, class: "group flex items-center pl-11 pr-2 py-2 text-sm font-medium rounded-md #{current_page?(schools_transport_vehicles_path) ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}" do %>
                <i class="fas fa-truck mr-3 flex-shrink-0 h-5 w-5"></i>
                Vehicles
              <% end %>
            </div>
          </div>
        <% end %>

        <% if current_school&.feature_enabled?('attendance') %>
          <%= link_to schools_attendance_records_path, class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{current_page?(schools_attendance_records_path) ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}" do %>
            <i class="fas fa-clipboard-check mr-3 flex-shrink-0 h-6 w-6"></i>
            Attendance
          <% end %>
        <% end %>

        <% if current_school&.feature_enabled?('timetable') %>
          <%= link_to schools_timetables_path, class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{current_page?(schools_timetables_path) ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}" do %>
            <i class="fas fa-calendar-alt mr-3 flex-shrink-0 h-6 w-6"></i>
            Timetable
          <% end %>
        <% end %>

        <% if current_school&.feature_enabled?('notices') %>
          <%= link_to schools_notices_path, class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{current_page?(schools_notices_path) ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}" do %>
            <i class="fas fa-bullhorn mr-3 flex-shrink-0 h-6 w-6"></i>
            Notices
          <% end %>
        <% end %>

        <%= link_to schools_leave_applications_path, class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{current_page?(schools_leave_applications_path) ? 'bg-gray-100 text-gray-900' : 'text-gray-600 hover:bg-gray-50 hover:text-gray-900'}" do %>
          <div class="relative">
            <svg class="mr-3 h-6 w-6 #{current_page?(schools_leave_applications_path) ? 'text-gray-500' : 'text-gray-400 group-hover:text-gray-500'}" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            <% if current_school.leave_applications.pending.exists? %>
              <span class="absolute -top-1 -right-1 flex h-4 w-4">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                <span class="relative inline-flex rounded-full h-4 w-4 bg-red-500 text-xs text-white items-center justify-center">
                  <%= current_school.leave_applications.pending.count %>
                </span>
              </span>
            <% end %>
          </div>
          Leave Applications
        <% end %>

        <%= link_to edit_school_owner_path(current_school_owner), class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{current_page?(edit_school_owner_path(current_school_owner)) ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}" do %>
          <i class="fas fa-cog mr-3 flex-shrink-0 h-6 w-6"></i>
          Settings
        <% end %>
      <% end %>
    </nav>
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var sidebar = document.getElementById('sidebar');
    var menuButton = document.getElementById('mobile-menu-button');
    var closeSidebar = document.getElementById('close-sidebar');
    function openSidebar() {
      sidebar.classList.remove('-translate-x-full');
    }
    function closeSidebarFunc() {
      sidebar.classList.add('-translate-x-full');
    }
    if (menuButton && sidebar) {
      menuButton.addEventListener('click', openSidebar);
    }
    if (closeSidebar && sidebar) {
      closeSidebar.addEventListener('click', closeSidebarFunc);
    }
    // Close sidebar on outside click (mobile only)
    document.addEventListener('click', function(event) {
      if (window.innerWidth < 1024 && sidebar && !sidebar.contains(event.target) && event.target.id !== 'mobile-menu-button') {
        closeSidebarFunc();
      }
    });
  });
</script> 